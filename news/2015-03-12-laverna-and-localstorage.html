<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Packaging Laverna: localStorage within Sandstorm - Sandstorm Blog</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:title" content="Sandstorm.io">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://sandstorm.io/logo-bw.png">
    <meta property="og:url" content="https://sandstorm.io">
    <meta property="og:description"
        content="Take control of your web by running your own personal cloud server with Sandstorm.">
    <link rel="stylesheet" type="text/css" href="/style.css">
    <link rel="alternate" type="application/rss+xml" title="Sandstorm.io Blog" href="/feed.xml">
  </head>



  <body id="blog">
    <nav>
      <a href="/">Sandstorm.io</a>
      <a href="/get">Sign Up</a>
      <a href="/get#self-hosting">Download</a>
      <a href="/features">Features</a>
      <a href="/how-it-works">How it Works</a>
      <a href="/news/">Blog</a>
      <a href="/community">Community</a>
      <a href="/about">About</a>
      <!-- TODO: search -->
    </nav>

    <header>
  <div class="sand">
    <h1>Sandstorm Blog</h1>
  </div>
</header>

<div class="post-list">

<div class="sidebar">
  <ul class="socialmedia">
    <li><a class="twitter" href="https://twitter.com/SandstormIO">Twitter</a>
    <li><a class="facebook" href="https://www.facebook.com/sandstorm.io" target="blank">Facebook</a>
    <li><a class="google" href="https://plus.google.com/+SandstormIo" target="_blank">Google</a>
    <li><a class="github" href="https://github.com/sandstorm-io/sandstorm" target="_blank">Github</a>
  </ul>

  <div class="more">
    <form id="signup" action="https://sandstorm.us7.list-manage.com/subscribe/post?u=1a036c5ea0fc3c215793748ed&amp;id=5d9399a0af" method="post">
      Join our mailing list for updates<br>
      <input type="email" name="EMAIL" placeholder="E-mail" required><input type="submit" value="Submit">
    </form>
    <a href="/get">
      Sandstorm is an open source operating system for personal and private clouds.
      <span class="signup" href="https://oasis.sandstorm.io">Sign up for free</span>
      <span class="selfhost" href="/install">or host your own</span>
    </a>
  </div>
</div>


<nav class="pagination top">
  <a class="newer" href="/news/" title="All posts">&laquo; All posts</a>
</nav>

<section>
  <h2>Packaging Laverna: localStorage within Sandstorm</h2>
  <p class="post-details">By <a href="https://github.com/jparyani">Jason Paryani</a>
    
    - 12 Mar 2015
  <p>Last week, I packaged <a href="https://laverna.cc/">Laverna</a> for Sandstorm and added it to the <a href="https://sandstorm.io/apps/">app list</a>. You can now use this open source note-taking app from any Sandstorm instance with one click. In this post, I explain how a purely client-side note-taking app integrates with Sandstorm for storage.</p>

<p>From the Laverna devs:</p>

<blockquote>
  <p>Laverna is a JavaScript note-taking web application with a Markdown editor and encryption support. It’s built to be an open source alternative to Evernote.</p>
</blockquote>

<p>Laverna is a fully <a href="https://github.com/sandstorm-io/sandstorm/wiki/Pure-client-apps">client side app</a> and typically stores all its data in IndexedDB/localStorage. In the case of the Sandstorm package, we configure the app to use localStorage and mirror any updates to localStorage to disk using a simple REST backend. On app start, we query the backend, and restore all the keys to localStorage.</p>

<p>Unfortunately (or maybe fortunately), there’s no way to monkey-patch the built-in localStorage to support this since it allows you to set keys by doing normal property access, ie. with <code>localStorage.KEY</code> or <code>localStorage[KEY]</code>. Javascript provides no way to shim over that, at least until <a href="https://github.com/lukehoban/es6features#proxies">ES6 proxies</a> are widely implemented.</p>

<p>It’s also worth noting that the backend is a very lightweight C++ server that uses the raw Sandstorm API. The backend’s only jobs are to serve the index.html, handle GET/POST/PUT/DELETE requests to allow fetching/persisting the localStorage keys, and provide one GET endpoint that lists all the keys that have been stored. Its memory footprint is incredibly small, which makes it ideal for Sandstorm. You can check out the source <a href="https://github.com/jparyani/laverna-sandstorm/blob/master/server.c%2B%2B">here</a>.</p>

<p>Within Laverna, it was surprisingly easy to add the automatic synchronizing. It took very little work to wire it up. You can see exactly how it works by reading <a href="https://github.com/jparyani/laverna/commit/38d7641fd2b0d64df80132493a933f97757f6413">my changes</a>. If there’s some interest, let me know by emailing jparyani@sandstorm.io, and I can think about writing a nice looking wrapper around localStorage that would handle this seamlessly.</p>

<p>If you want to test this out, you can try <a href="https://demo.sandstorm.io/appdemo/4dgxs5m0gnjmjpg88mswqsy9fj08t3z6c8kwv4y9tkgxvp9eas9h">Laverna on the Sandstorm demo</a>; look at the network inspector tab in your browser as it runs.</p>

</section>

</div>


    <footer>
      <ul>
        <li>
          <h3><a href="/get">Get Sandstorm</a></h3>
          <ul>
            <li><a href="/get">For Individuals</a>
            <li><a href="/get#self-host">For Organizations</a>
            <li><a href="/get#self-host">For Self-hosters</a>
          </ul>
        </li>
        <li>
          <h3><a href="/features">Features</a></h3>
          <ul>
            <li><a href="/features">Core</a>
            <li><a href="/features#security">Security</a>
            <li><a href="/business">Sandstorm + Business</a>
            <li><a href="/business#scale">Sandstorm + Scale</a>
            <li><a href="/developer">Development</a>
          </ul>
        </li>
        <li>
          <h3><a href="how-it-works">How it Works</a></h3>
          <ul>
            <li><a href="/how-it-works#grains">Fine-grained object containers</a>
            <li><a href="/how-it-works#capabilities">Capability-based Security</a>
          </ul>
        </li>
        <li>
          <h3><a href="/community">Community</a>              </h3>
          <ul>
            <li><a href="/community#connect-with">Connect with us</a>
            <li><a href="/community#helpothers">Help Others</a>
            <li><a href="/community#helpproject">Help the Project</a>
          </ul>
        </li>
        <li>
          <h3><a href="/about">About</a></h3>
          <ul>
            <li><a href="/about">Sandstorm Story</a>
            <li><a href="/about#team">Team</a>
            <li><a href="/about#advisors">Advisors</a>
            <li><a href="mailto:contact@sandstorm.io">Contact</a>
          </ul>
        </li>
        <li>
        <h3><a href="https://oasis.sandstorm.io">Oasis Hosting</a></h3>
          <ul>
            <li class="sign-in-footer"><a href="https://oasis.sandstorm.io">Sign in</a>
          </ul>
        </li>
        <li>
          <h3><a href="/blog">Blog</a></h3>
          <ul>
            <li><a href="/blog">Latest updates on Sandstorm.io</a>
          </ul>
        </li>
        <li>
          <h3>Join our mailing list!</h3>
            <div class="subscribe-small">
							<form action="https://sandstorm.us7.list-manage.com/subscribe/post?u=1a036c5ea0fc3c215793748ed&amp;id=5d9399a0af" method="post">
								<input type="email" name="EMAIL" placeholder="e-mail" required>
								<input type="submit" value="Submit">
								</form>
            </div>
          <ul>
            <li><a href=""></a>
          </ul>
        </li>
        <li>
          <h3>Connect</h3>
          <ul id="socialmedia-small">
						<li><a class="twitter" href="https://twitter.com/SandstormIO"></a>
						<li><a class="google" href="https://plus.google.com/+SandstormIo" target="_blank"></a>
						<li><a class="facebook" href="https://www.facebook.com/sandstorm.io" target="blank"></a>
						<li><a class="github" href="https://github.com/sandstorm-io/sandstorm" target="_blank"></a>
  			</ul>
        </li>
      </ul>
      <p>This page was hand-crafted using only the finest web technologies.
    </footer>

    <!-- Google Analytics -->
    <script type="text/javascript">
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-42127409-1', 'sandstorm.io');
      ga('send', 'pageview');
    </script>

    <!-- livereload, for development -->
    <script type="text/javascript">
      if (document.location.hostname === "localhost") {
        document.write('<script src="http://localhost:35729/livereload.js"></scr' + 'ipt>');
      }
    </script>
  </body>
</html>
