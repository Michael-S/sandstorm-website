<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Why doesn't Sandstorm just run Docker apps? - Sandstorm Blog</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:title" content="Why doesn't Sandstorm just run Docker apps?">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://sandstorm.io/images/sandcat.png">
    <meta property="og:url" content="https://sandstorm.io/news/2014-08-19-why-not-run-docker-apps">
    <meta property="og:description"
        content="Real-time collaborative web productivity suite behind the firewall.">
    <link rel="stylesheet" type="text/css" href="/style.css">
    <link rel="alternate" type="application/rss+xml" title="Sandstorm.io Blog" href="/feed.xml">
    
<script src="/ga-helper.js"></script>
<script>
(function(){

function getIdFromCookie() {
  var match = document.cookie.match(new RegExp("(^| )sandstormStatsId=([^;]+)"));
  if (match) return match[2];
}

function setIdCookie(val) {
  var d = new Date();
  d.setMonth(d.getMonth() + 120);
  document.cookie = "sandstormStatsId=" + val + ";expires=" + d + ";domain=.sandstorm.io;";
}

function uidGenerator() {
  if (window.crypto && window.crypto.getRandomValues) {
    var array = new Uint32Array(4);
    window.crypto.getRandomValues(array);
    return array[0] + "-" + array[1] + "-" + array[2] + "-" + array[3];
  } else {
    var genInt = function() {
      return Math.floor(Math.random() * 0x100000000);
    }
    return genInt() + "-" + genInt() + "-" + genInt() + "-" + genInt();
  }
}

function getId() {
  var id = getIdFromCookie();
  if (!id) {
    id = uidGenerator();
    setIdCookie(id);
  }
  return id;
}

function sendData(data, path) {
  var xhr = new XMLHttpRequest();

  xhr.onreadystatechange = function () {
    if (xhr.readyState == 4) {
      if (xhr.status >= 200 && xhr.status < 300) {
        // do nothing
      } else {
        console.error("analytics send failed:", xhr.statusText, xhr.responseText);
      }
    }
  };

  xhr.open("POST", "https://api-5d23e9c497f90642a85ba1fb909fa9d8.oasis.sandstorm.io/" + path, true);

  xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
  xhr.setRequestHeader("Authorization", "Bearer hVU87Vp2UzNnRmMepiXpjKUk6n6MZc7YMgAJ6YrVe-6");

  xhr.send(JSON.stringify(data));
}


function isInExperiment(userId, exp) {
  var idBlocks = userId.split("-");
  var id = parseInt(idBlocks[0], 10);
  return exp.exp_range_start <= id && id < exp.exp_range_end;
}

function addCssOverride(inExperiment, id, activeDisplayValue) {
  var s = document.createElement('style');
  s.type = 'text/css';
  var r = "";
  if (inExperiment) {
    r = r + ".exp-" + id + "-baseline { display: none !important; }\n";
    r = r + ".exp-" + id + "-test { display: " + activeDisplayValue + " !important; }\n";
  }
  s.innerHTML = r;
  document.getElementsByTagName('head')[0].appendChild(s);
}

var experiments = [
  {
    id: "install-screencast-autoplay",
    exp_range_start: 0,
    exp_range_end: 0x7fffffff, // 50% of users
    hook: function (userId, exp, inExperiment) {
      // Creates a stylesheet with a pair of classes that change the display: property,
      // allowing hiding of baseline content and showing of experimental content.
      addCssOverride(inExperiment, exp.id, "block");
    }
  }
];

var experimentMembership = {};
var userId = getId();
for (var i=0; i<experiments.length; i++) {
  var exp = experiments[i];
  var a = isInExperiment(userId, exp);
  exp.inExperiment = a;
  experimentMembership[exp.id] = a;
}

function runExperimentHooks() {
  for (var i=0; i<experiments.length; i++) {
    if (exp.hook) {
      exp.hook(userId, exp, exp.inExperiment);
    }
  }
}

function trackView() {
  var id = getId();
  sendData({
    uid: id,
    referrer: document.referrer,
    location: window.location + '',
    experiments: experimentMembership
  }, "pageEvent");
}

function trackClick(elementId) {
  var id = getId();
  sendData({
    uid: id,
    elementId: elementId,
    location: window.location + '',
    experiments: experimentMembership
  }, "clickEvent");
}


runExperimentHooks();
trackView();

window.sandstormTracker = {
  trackView: trackView,
  trackClick: trackClick,
  experiments: experiments,
  getId: getId
};

})();
</script>

  </head>



  <body id="blog">
    <nav>
      <a href="/">Sandstorm.io</a>
      <a href="/get">Get Sandstorm</a>
      <a href="/features">Features</a>
      <a href="/how-it-works">How it Works</a>
      <a href="/news/">Blog</a>
      <a href="https://docs.sandstorm.io">Docs</a>
      <a href="https://github.com/sandstorm-io/sandstorm">Code</a>
      <a href="/community">Community</a>
      <a href="/about">About</a>
      <!-- TODO: search -->
    </nav>

    <header>
  <div class="sand">
    <h1>Sandstorm Blog</h1>
  </div>
</header>

<div class="post-list">

<div class="sidebar">
  <ul class="socialmedia">
    <li><a class="twitter" href="https://twitter.com/SandstormIO">Twitter</a>
    <li><a class="facebook" href="https://www.facebook.com/sandstorm.io" target="blank">Facebook</a>
    <li><a class="google" href="https://plus.google.com/+SandstormIo" target="_blank">Google</a>
    <li><a class="github" href="https://github.com/sandstorm-io/sandstorm" target="_blank">Github</a>
  </ul>

  <div class="more">
    <form id="signup" action="https://sandstorm.us7.list-manage.com/subscribe/post?u=1a036c5ea0fc3c215793748ed&amp;id=5d9399a0af" method="post">
      Join our mailing list for updates<br>
      <input type="email" name="EMAIL" placeholder="E-mail" required><input type="submit" value="Submit">
    </form>
    <a href="/get">
      Sandstorm is a self-hostable web productivity suite.
      <span class="signup" href="https://oasis.sandstorm.io">Sign up for free</span>
      <span class="selfhost" href="/install">or host your own</span>
    </a>
    
    <h3>Recommended Posts</h3>
    <ul>
      <li><a href="/news/2014-07-21-open-source-web-apps-require-federated-hosting">Open Source Web Apps Aren't Viable; Let's Fix That</a></li>
      <li><a href="/news/2016-02-29-security-track-record">Sandstorm's security track record, and what it means for self-hosting</a></li>
      <li><a href="/news/2016-08-17-decentralization-is-about-diversity">Decentralization is about diversity</a></li>
      <li><a href="/news/2016-01-22-8-new-open-source-apps.html">8 New open source self-hostable apps</a></li>
      <li><a href="/news/2016-04-06-sandstorm-for-work">Sandstorm for Work Beta: LDAP, SAML, organization management</a></li>
      <li><a href="/news/2016-02-05-app-author-publicity-oasis">Free publicity for your indie web app, and free Oasis service for you</a></li>
      <li><a href="/news/2015-10-01-free-ssl-certificates.html">Free, automated SSL certificates for Sandstorm self-hosters</a></li>
      <li><a href="/news/2014-08-19-why-not-run-docker-apps.html">Why doesn't Sandstorm just run Docker apps?</a></li>
      <li><a href="/news/2015-05-05-delegation-is-the-cornerstone-of-civilization.html">Understand the Sandstorm sharing model</a></li>
    </ul>
    
    <h3>Further Reading</h3>
      <ul>
        <li><a href="/how-it-works">How Sandstorm Works</a></li>
        <li><a href="http://docs.sandstorm.io">Sandstorm Documentation</a></li>
        <li><a href="/install">How to install Sandstorm</a></li>
      </ul>
  </div>
</div>


<nav class="pagination top">
  <a class="newer" href="/news/" title="All posts">&laquo; All posts</a>
</nav>

<section>
  <h2>Why doesn't Sandstorm just run Docker apps?</h2>
  <p class="post-details">By <a href="https://github.com/kentonv">Kenton Varda</a>
    
    - 19 Aug 2014
  <p>We get this question a lot. Sandstorm and Docker use the same Linux kernel features for containerization. Docker already has a large ecosystem of apps. Why introduce a new app format? Why not simply position Sandstorm as a UI for Docker? Wouldn’t that save a lot of work? Why reinvent the wheel?</p>

<p>The fact of the matter is, Sandstorm and Docker, despite similar underlying tech, are very different platforms. Asking why Sandstorm doesn’t run Docker apps is a lot like asking why Android doesn’t run Linux desktop apps. If it’s the same Linux kernel under the hood, shouldn’t it be able to run the same apps? Well, a Linux desktop app would have a lot of problems running on Android. Most obviously, a desktop app’s UX would be all wrong on a small touchscreen. Moreover, the app would not fit into Android’s security model. It would not understand Android’s battery-saving lifecycle rules. It would not know how to tap into the unique devices (e.g. accelerometer, GPS) and opportunities (e.g. connecting with nearby devices) commonly available on phones but not on desktop.</p>

<blockquote>Asking why Sandstorm doesn't run Docker apps is a lot like asking why Android doesn't run Linux desktop apps.</blockquote>

<p>Running a Docker app on Sandstorm would be much the same story. Docker is designed to run off-the-shelf server-oriented Linux software and distributions inside containers. Docker’s platform, from the app’s point of view, is just Linux. From the user’s point of view, you use Docker much like you’d use traditional VMs and compute clusters; it’s just a lot more efficient.</p>

<p>Sandstorm, though, is doing something completely different. We are trying to manage personal servers for end users. With Sandstorm, the person deciding what software to deploy is not necessarily a developer or system administrator. They may not know how to use a command line or edit config files. They may not know what a database is, and so aren’t likely to understand why they need to set up MySQL before they can run that app they’re interested in.</p>

<p>This use case calls for a completely different model, just as phones call for a different model from desktops. We need to design a bunch of things differently:</p>

<ul>
  <li>
    <p>Every app must have a web interface, and they must expose all configuration options through that interface.</p>
  </li>
  <li>
    <p>Users expect their data to be organized in units of documents or other semantic objects, not in units of databases or relational tables. Apps must set up their own database and encapsulate it appropriately; the user won’t do it for them.</p>
  </li>
  <li>
    <p>Users should not have to log into every app separately, especially when the app instance already belongs specifically to them and Sandstorm is already protecting access. So, apps must integrate with Sandstorm’s unified login system.</p>
  </li>
  <li>
    <p>It would also be nice if users did not have to master a different sharing model for every app. Sandstorm supports fine-grained containers, such that every document can actually be in a separate container. This way, the platform can handle sharing consistently across all apps, by applying sharing to the containers. But, apps have to be designed for this.</p>
  </li>
  <li>
    <p>Permission grants must be expressed in a way that users can understand. A user does not know what it means to allow an app to communicate on port 25, but they do know what it means to allow an app to send and receive e-mail under a particular e-mail address. In order for such permissions to be enforceable, the platform’s security model must actually operate in terms of these semantic permissions, not arbitrary TCP connections.</p>
  </li>
  <li>
    <p>Updating an app must be a one-click (or even automatic) process. This means there must be a clearly-defined separation between the app “image” and its instance data, so that the platform is able to replace the former without harming the latter.</p>
  </li>
  <li>
    <p>Users <em>will</em> install malicious apps from time to time, and they must be protected from these. The regular Linux kernel interface is far too wide, and critical exploits are found too often. We must instead present a much narrower interface and force apps to adapt. <a href="/news/2014-08-13-sandbox-security.html">See our previous post on this.</a></p>
  </li>
</ul>

<p>For all these reasons, a Docker app simply would not be able to run under Sandstorm without modification. The modifications needed for typical Linux web apps tend to be light, but they are necessary.</p>

<h3 id="why-not-at-least-use-the-container-tech">Why not at least use the container tech?</h3>

<p>So, we’ve seen that it wouldn’t make sense to run a regular Docker app on Sandstorm. But, why don’t we still use Docker’s tech, and simply define an extra set of rules which Sandstorm apps much follow? Sandstorm would only be able to run the apps explicitly targeted for it, but at least we wouldn’t be reinventing the wheel technically, right?</p>

<p>Well, first of all, we <em>do</em> use a lot of the same tech as Docker. Namely, we use the Linux kernel sandboxing features, such as namespaces and (soon) cgroups. These features do all of the heavy lifting of containerization.</p>

<p>When it comes to userspace tools, it turns out that we just don’t really need anything Docker provides. Docker’s tools are designed to be highly adaptable and configurable in order to accommodate a wide range of Linux software without modification. Sandstorm, however, isn’t trying to run arbitrary Linux software. Apps already have to be adapted to Sandstorm’s environment. So, we are actually better off providing minimal configurability in order to keep the core system simple.</p>

<p>Setting up a Sandstorm sandbox, based on raw Linux system calls, takes only a few hundred lines of code. Using Docker, it would probably be a few hundred lines of configuration instead, while adding a huge new dependency and all the maintenance issues that come with that. We would probably regularly find ourselves needing to push features upstream to Docker which Docker doesn’t otherwise need or want. It’s a lot of burden that wouldn’t buy us anything.</p>

<p>We <em>do</em> often use Docker’s build tools in the process of building Sandstorm packages, simply because they provide a structured and reproducible way to gather an app and its dependencies into a chroot environment, which we can then package up. This is a fine option for app developers that does not affect the runtime system.</p>

<h3 id="to-be-clear-docker-is-awesome">To be clear, Docker is awesome</h3>

<p>We aren’t trying to dis Docker here. For what it’s trying to do – replace VMs with something not as horribly inefficient – Docker is amazing. We are excited to see it replace legacy IaaS solutions, and we will likely be targeting it as a way to run Sandstorm itself.</p>

<p>But despite an initial appearance of similarity, Docker and Sandstorm simply aren’t the same thing, and forced sharing of code for very different purposes would not benefit either project.</p>

<p><em>If you want to see Sandstorm succeed, there are 13 days left to <a href="http://igg.me/at/sandstorm">contribute to the campaign</a>.</em></p>

</section>

</div>


    <footer>
      <ul>
        <li>
          <h3><a href="/get">Get Sandstorm</a></h3>
          <ul>
            <li><a href="/get">Sandstorm on Oasis</a>
            <li><a href="/get">Sandstorm Standard</a>
            <li><a href="/get">Sandstorm for Work</a>
            <li><a href="https://github.com/sandstorm-io/sandstorm">Source Code (GitHub)</a>
            <li><a href="/go/education">For Educators</a></li>
          </ul>
        </li>
        <li>
          <h3><a href="/features">Features</a></h3>
          <ul>
            <li><a href="https://apps.sandstorm.io">App Market</a></li>
            <li><a href="/features">Core features</a>
            <li><a href="/features#security">Security features</a>
            <li><a href="/business">Sandstorm for Work</a>
            <li><a href="/business#scale">Sandstorm for Enterprise</a>
            <li><a href="/developer">Development</a>
          </ul>
        </li>
        <li>
          <h3><a href="https://docs.sandstorm.io">Documentation</a></h3>
          <ul>
            <li><a href="https://docs.sandstorm.io/en/latest/using/">How to use Sandstorm</a>
            <li><a href="https://docs.sandstorm.io/en/latest/developing/">Developer Hub</a>
            <li><a href="https://docs.sandstorm.io/en/latest/administering/">Administering &amp; installing</a>
            <li><a href="https://docs.sandstorm.io/en/latest/using/security-practices/">Security</a>
          </ul>
        </li>
        <li>
          <h3><a href="/how-it-works">How it Works</a></h3>
          <ul>
            <li><a href="/how-it-works#grains">Fine-grained object containers</a>
            <li><a href="/how-it-works#capabilities">Capability-based Security</a>
          </ul>
        </li>
        <li>
          <h3><a href="/community">Community</a></h3>
          <ul>
            <li><a href="/news">Sandstorm Blog</a>
            <li><a href="/community#connect-with">Connect with us</a>
            <li><a href="/community#helpothers">Help Others</a>
            <li><a href="/community#helpproject">Help the Project</a>
          </ul>
        </li>
        <li>
          <h3><a href="/about">About</a></h3>
          <ul>
            <li><a href="/about">Sandstorm Story</a>
            <li><a href="/about#team">Team</a>
            <li><a href="/about#advisors">Advisors</a>
            <li><a href="mailto:contact@sandstorm.io">Contact</a>
          </ul>
        </li>
        <li>
          <h3><a href="https://oasis.sandstorm.io">Oasis Hosting</a></h3>
          <ul>
            <li class="sign-in-footer"><a href="https://oasis.sandstorm.io">Sign in</a>
          </ul>
        </li>
        <li>
          <h3>Connect</h3>
          <ul id="socialmedia-small">
						<li><a class="twitter" href="https://twitter.com/SandstormIO"></a>
						<li><a class="google" href="https://plus.google.com/+SandstormIo" target="_blank"></a>
						<li><a class="facebook" href="https://www.facebook.com/sandstorm.io" target="blank"></a>
						<li><a class="github" href="https://github.com/sandstorm-io/sandstorm" target="_blank"></a>
  			</ul>
        </li>
        <li>
          <h3>Join our mailing list!</h3>
            <div class="subscribe-small">
                                                        <form action="https://sandstorm.us7.list-manage.com/subscribe/post?u=1a036c5ea0fc3c215793748ed&amp;id=5d9399a0af" method="post">
                                                                <input type="email" name="EMAIL" placeholder="e-mail" required>
                                                                <input type="submit" value="Submit">
                                                                </form>
            </div>
          <ul>
            <li><a href=""></a>
          </ul>
        </li>
      </ul>
      <p>This page was hand-crafted using only the finest web technologies.
    </footer>

    <!-- Google Analytics -->
    <script type="text/javascript">
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-42127409-1', 'sandstorm.io');
      ga('send', 'pageview');
    </script>

    <!-- livereload, for development -->
    <script type="text/javascript">
      if (document.location.hostname === "localhost") {
        document.write('<script src="http://localhost:35729/livereload.js"></scr' + 'ipt>');
      }
    </script>
  </body>
</html>
